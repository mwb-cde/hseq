########################################################################
# Permission is hereby granted, free of charge, to any person
# obtaining a copy of this file, to deal in the File without
# restriction, including without limitation the rights to use,
# copy, modify, merge, publish, distribute, sublicense, and/or
# sell copies of the File, and to permit persons to whom the
# File is furnished to do so, subject to the following condition:
#
# THE FILE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
# OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
# IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
# DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
# OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE FILE OR
# THE USE OR OTHER DEALINGS IN THE FILE.

########################################################################

###
# OMakefile
# Author: M Wahab <mwahab@users.sourceforge.net>
# Copyright M Wahab 2006
###


###
# Variables
###

# SUBDIRS: The sub-directories to build (in order)
SUBDIRS = quickstart

# HTMLDIR: HTML Documentation directory
HTMLDIR = $(dir $(DOCDIR)/html)

# INFODIR: Info Documentation directory
INFODIR = $(dir $(DOCDIR)/info)

# HTMLDIR: HTML installation Documentation directory
IHTMLDIR = $(dir $(IDOCDIR)/html)

# INFODIR: Info Installation documentation directory
IINFODIR = $(dir $(IDOCDIR)/info)

##
# Local build targets
##

.PHONY: build
.PHONY: install
.PHONY: clean
.PHONY: reallyclean

.PHONY: install-html
.PHONY: install-info

.PHONY: build-html
.PHONY: build-info

##
# Compiler commands
##

# MIINCLDUE: Common include directives
MIINCLUDE = 

# MIOPTIONS: Common options
MIOPTIONS = 

# MAKEINFO: makeinfo
MAKEINFO = makeinfo $(MIOPTIONS)

##
# Common commands
##

TexiFiles (files) = 
  return $(mapsuffix .texi, $(files))

InfoFiles (files) = 
  return $(mapsuffix .info, $(files))

MakeHtml(files) =
  foreach (f, $(files))
    -$(MAKEINFO) --html $(f)

MakeInfo(files) =
  foreach (f, $(files))
    -$(MAKEINFO) --info $(f)

# BuildHtml: Standard html building target
BuildHtml(tag, files) =
  tfiles = $(TexiFiles $(files)) 
  $(tag): $(tfiles)
      MakeHtml($(tfiles))

# BuildInfo: Standard info building target
BuildInfo(tag, files) =
  tfiles = $(TexiFiles $(files)) 
  $(tag): $(tfiles)
      MakeInfo($(tfiles))

# InstallHtml(tag, src, dst): Standard html installation target
# Each name in src is a directory to copy to dst
InstallHtml(tag, src, dst) =
  $(tag): $(dst)
    $(COPY) $(src) $(dst)

# InstallInfo(tag, src, dst): Standard info installation target
# Each name in src is a directory to copy to dst
InstallInfo(tag, src, dst) =
  ifiles = $(InfoFiles $(files)) 
  $(tag): $(dst)
    $(COPY) $(ifiles) $(dst)

##
# How to build the subdirectories 
##

# The rules for a subdirectory
DirRules(sub, srcfiles) =
  BuildHtml(build-html, $(srcfiles))
  BuildInfo(build-info, $(srcfiles))
#  InstallHtml(install-html, $(srcfiles), $(HTMLDIR))
#  InstallHtml(install-info, $(srcfiles), $(INFODIR))

#.SUBDIRS: $(SUBDIRS)

# Temporarily, each subdirectory is listed seperately
.SUBDIRS: quickstart
   FILES = hseq-quickstart
   DirRules(quickstart, $(FILES))

##
# Build targets
##

## How to build the directories

IDirs = html info

MkIDirs (idirs) =
  foreach (d, $(idirs))
    $(IDOCDIR)/$(d): $(IDOCDIR)
      $(MKDIR) $(IDOCDIR)/$(d)

MkIDirs($(IDirs))

##
# Installation targets
##

EXCLUDE_FILES = CVS Makefile OMakefile OMakefile.omc

install-info: $(IINFODIR)
  section
    adir = $(glob $(INFODIR)/*)
    foreach (name, $(adir))
      if $(not $(mem $(basename $(name)), $(EXCLUDE_FILES)))
        $(MKDIR) $(IDOCDIR)/$(name)
        $(COPY) $(name)/* $(IDOCDIR)/$(name)

install-html: $(IHTMLDIR)
  section
    adir = $(glob $(HTMLDIR)/*)
    foreach (name, $(adir))
      if $(not $(mem $(basename $(name)), $(EXCLUDE_FILES)))
        $(MKDIR) $(IDOCDIR)/$(name)
        $(COPY) $(name)/* $(IDOCDIR)/$(name)

install-doc: install-html


##
# Cleaning files
##

clean:
	$(RM) *.info *~

reallyclean: clean 

