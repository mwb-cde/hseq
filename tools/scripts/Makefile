########################################################## --*- Makefile -*--
# Copyright (c) 2011-2021 Matthew Wahab <mwb.cde@gmail.com>
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
######################################################################

#####
# Definitions and rules for building modules.
#
# REQUIREMENTS
# ------------
#
# Must set PROJ_ROOT.
# PROJ_ROOT: Variable containing relative path to top of the source tree.
#
# Must end with
#    include $(PROJ_ROOT)/Makefile.common
#
#####

#####
# Required definitions
#

# PROJ_ROOT: Relative path to HSeq root.
PROJ_ROOT=../..

#####
# Module building settings
#

# PROGRAMS: List of programs to build.
PROGRAMS=hseqb hseqc

#####
# Object building settings
#

# object_SOURCES: List of source file names, without suffixes.
hseqb_SOURCES=hseqb
hseqc_SOURCES=hseqc

# object_HEADERS: List of headers, without suffixes. Default is object_SOURCES
hseqb_HEADERS=
hseqc_HEADERS=

# object_LIBS: Libraries to include when linking [object].
hseqb_LIBS=unix.cma hseq.cma
hseqc_LIBS=unix.cma hseq.cma

# object_NATLIBS: Libraries to include when native-code linking [object].
hseqb_NATLIBS=unix.cmxa hseq.cmxa
hseqc_NATLIBS=unix.cmxa hseq.cmxa

hseqb_INCLUDE=$(SRC_ROOT)/hsequser $(SRC_ROOT)/hseq +unix
hseqc_INCLUDE=$(SRC_ROOT)/hsequser $(SRC_ROOT)/hseq +unix

#####
# Module build tool settings

# hseqb.ml is generated from hseqb.mlp.
# hseqc.ml is generated from hseqc.mlp.
#.INTERMEDIATE: hseqb.ml hseqc.ml

######################################################################
# DO NOT CHANGE ANYTHING IN THIS SECTION
######################################################################

###
# Include common definitions

# Test for PROJ_ROOT being defined.
ifndef PROJ_ROOT
$(error "PROJ_ROOT Must be set to relative path to HSeq root")
endif

include $(PROJ_ROOT)/Makefile.rules

######################################################################
# END OF SECTION
######################################################################


###
# Local build rules.

# Configuration data. Generated by the toplevel configure script, copied and
# compiled into the hseq libraries.
# .INTERMEDIATE: hseqb_config.mli hseqb_config.ml
# hseqb_config.mli hseqc_config.mli: $(SRC_ROOT)/config.mli
# 	$(COPY) $(SRC_ROOT)/config.mli $@
# .INTERMEDIATE: hseqc_config.mli hseqc_config.ml
# hseqb_config.ml hseqc_config.ml: $(SRC_ROOT)/config.ml
# 	$(COPY) $(SRC_ROOT)/config.ml $@
